# Architecture

**Claude Code Deep Research Agent** - ç³»ç»Ÿæ¶æ„æ–‡æ¡£

> ğŸ“˜ **ç›¸å…³æ–‡æ¡£**: [CLAUDE.md](CLAUDE.md) | [RESEARCH_METHODOLOGY.md](RESEARCH_METHODOLOGY.md)

---

## è®¾è®¡åŸåˆ™

### æ ¸å¿ƒç†å¿µ

```
æ¨¡å—åŒ– > å•ä½“
æ¥å£ > å®ç°
ç»„åˆ > ç»§æ‰¿
å£°æ˜å¼ > å‘½ä»¤å¼
```

### æ¶æ„ç›®æ ‡

1. **å¯æ‰©å±•æ€§** - è½»æ¾æ·»åŠ æ–°çš„ç ”ç©¶æŠ€èƒ½å’Œä»£ç†ç±»å‹
2. **å¯ç»´æŠ¤æ€§** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œä¾èµ–ç®¡ç†
3. **å¯è§‚æµ‹æ€§** - å®Œæ•´çš„çŠ¶æ€è¿½è¸ªå’Œè¿›åº¦æŠ¥å‘Š
4. **å®¹é”™æ€§** - æ£€æŸ¥ç‚¹æ¢å¤å’Œä¼˜é›…é™çº§

---

## ç³»ç»Ÿæ¶æ„

### åˆ†å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ¥å£å±‚                             â”‚
â”‚                   (Commands: /deep-research)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ invokes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æŠ€èƒ½å±‚ (Skills)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Question     â”‚  â”‚ Research     â”‚  â”‚ Citation     â”‚     â”‚
â”‚  â”‚ Refiner      â”‚  â”‚ Executor     â”‚  â”‚ Validator    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  (è–„å°è£… - è¾“å…¥éªŒè¯ + ä»£ç†è°ƒç”¨)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ invokes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä»£ç†å±‚ (Agents)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Coordinatorâ”‚  â”‚ Phase-N    â”‚  â”‚ Support    â”‚           â”‚
â”‚  â”‚ Workflow   â”‚  â”‚ Workflows  â”‚  â”‚ Agents     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  (ä½¿ç”¨ general-purpose å†…ç½®ä»£ç†ç±»å‹)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ MCP Tools   â”‚  â”‚ State Mgmt   â”‚  â”‚ Token Budget â”‚      â”‚
â”‚  â”‚ (æ•°æ®å¤„ç†)   â”‚  â”‚ (SQLite)     â”‚  â”‚ (èµ„æºæ§åˆ¶)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         RecoveryHandler + ContentCompressor      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ commands/                  # ç”¨æˆ·å‘½ä»¤ (å¿«æ·æ–¹å¼)
â”‚   â”‚   â”œâ”€â”€ deep-research.md
â”‚   â”‚   â”œâ”€â”€ refine-question.md
â”‚   â”‚   â”œâ”€â”€ plan-research.md
â”‚   â”‚   â”œâ”€â”€ synthesize-findings.md
â”‚   â”‚   â””â”€â”€ validate-citations.md
â”‚   â”‚
â”‚   â”œâ”€â”€ skills/                    # æŠ€èƒ½å®šä¹‰ (å¯å¤ç”¨èƒ½åŠ›)
â”‚   â”‚   â”œâ”€â”€ question-refiner/
â”‚   â”‚   â”‚   â”œâ”€â”€ SKILL.md
â”‚   â”‚   â”‚   â”œâ”€â”€ instructions.md
â”‚   â”‚   â”‚   â””â”€â”€ examples.md
â”‚   â”‚   â”œâ”€â”€ research-executor/
â”‚   â”‚   â””â”€â”€ citation-validator/
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                    # ä»£ç†å·¥ä½œæµå®šä¹‰ (å‚è€ƒæ–‡æ¡£)
â”‚   â”‚   â”œâ”€â”€ coordinator/
â”‚   â”‚   â”œâ”€â”€ phase-1-refinement/
â”‚   â”‚   â”œâ”€â”€ phase-2-planning/
â”‚   â”‚   â”œâ”€â”€ phase-3-execution/
â”‚   â”‚   â”œâ”€â”€ phase-4-processing/
â”‚   â”‚   â”œâ”€â”€ phase-5-synthesis/
â”‚   â”‚   â”œâ”€â”€ phase-6-validation/
â”‚   â”‚   â”œâ”€â”€ phase-7-output/
â”‚   â”‚   â”œâ”€â”€ synthesizer-agent/
â”‚   â”‚   â””â”€â”€ red-team-agent/
â”‚   â”‚
â”‚   â””â”€â”€ mcp-server/                # MCP æœåŠ¡å™¨ (åŸºç¡€è®¾æ–½)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ tools/             # å·¥å…·å®ç°
â”‚       â”‚   â”œâ”€â”€ state/             # çŠ¶æ€ç®¡ç†
â”‚       â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ state/
â”‚           â””â”€â”€ research_state.db  # SQLite æ•°æ®åº“
â”‚
â”œâ”€â”€ RESEARCH/                      # ç ”ç©¶è¾“å‡ºç›®å½•
â”‚   â””â”€â”€ [topic_name]/
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ executive_summary.md
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ CLAUDE.md                      # å¿«é€Ÿå‚è€ƒ
â”œâ”€â”€ ARCHITECTURE.md                # æœ¬æ–‡æ¡£
â”œâ”€â”€ RESEARCH_METHODOLOGY.md        # ç ”ç©¶æ–¹æ³•è®º
â”œâ”€â”€ README.md                      # ç”¨æˆ·æŒ‡å—
â””â”€â”€ FAQ.md                         # å¸¸è§é—®é¢˜
```

---

## æŠ€èƒ½ç³»ç»Ÿ

### ä»€ä¹ˆæ˜¯æŠ€èƒ½ï¼Ÿ

æŠ€èƒ½æ˜¯æ¨¡å—åŒ–ã€å¯å¤ç”¨çš„èƒ½åŠ›å•å…ƒï¼Œæ¯ä¸ªæŠ€èƒ½åŒ…å«ï¼š

- **SKILL.md** - å…ƒæ•°æ®å’Œæè¿° (YAML frontmatter)
- **instructions.md** - è¯¦ç»†å®ç°æŒ‡å—
- **examples.md** - ä½¿ç”¨ç¤ºä¾‹

### æŠ€èƒ½ç»“æ„

```yaml
# SKILL.md frontmatter
name: skill-name
description: Brief description
version: 1.0.0
author: Your Name
tags: [research, analysis]
```

### æ ¸å¿ƒæŠ€èƒ½

| æŠ€èƒ½ | ç”¨é€” | è§¦å‘æ–¹å¼ |
|------|------|----------|
| `question-refiner` | é—®é¢˜ç»“æ„åŒ– | ç”¨æˆ·è°ƒç”¨ã€Phase 1 è‡ªåŠ¨ |
| `research-planner` | åˆ›å»ºæ‰§è¡Œè®¡åˆ’ | ç”¨æˆ·è°ƒç”¨ã€Phase 2 è‡ªåŠ¨ |
| `research-executor` | æ‰§è¡Œ7é˜¶æ®µå·¥ä½œæµ | ç”¨æˆ·è°ƒç”¨ `/deep-research` |
| `citation-validator` | éªŒè¯å¼•ç”¨è´¨é‡ | ç”¨æˆ·è°ƒç”¨ã€Phase 6 è‡ªåŠ¨ |

### æŠ€èƒ½è®¾è®¡æ¨¡å¼

```typescript
// æŠ€èƒ½ä½œä¸ºè–„å°è£…å±‚
class Skill {
  async execute(input: UserInput): Promise<SkillOutput> {
    // 1. éªŒè¯è¾“å…¥
    const validated = this.validate(input);

    // 2. è°ƒç”¨é€šç”¨ä»£ç†
    const agent = new GeneralPurposeAgent();
    agent.setInstructions(this.loadWorkflow());

    // 3. è¿”å›ç»“æœ
    return await agent.run(validated);
  }
}
```

**å…³é”®åŸåˆ™**:
- æŠ€èƒ½ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ â†’ å§”æ‰˜ç»™ä»£ç†
- æŠ€èƒ½ä¸“æ³¨äºæ¥å£å’ŒéªŒè¯
- å·¥ä½œæµå®šä¹‰å­˜å‚¨åœ¨ `.claude/agents/` ä¸­

---

## ä»£ç†å·¥ä½œæµç³»ç»Ÿ

### ä»£ç†ç±»å‹æ˜ å°„

```
.claude/agents/[workflow-name]/AGENT.md  â†’  å·¥ä½œæµå®šä¹‰æ–‡æ¡£
                                           â†“
                         ä¸æ˜¯å®é™…çš„ä»£ç†ç±»å‹
                                           â†“
           Claude Code çš„ general-purpose å†…ç½®ä»£ç†ç±»å‹
                                           â†“
                      æŠ€èƒ½åµŒå…¥å·¥ä½œæµæŒ‡ä»¤
```

### å·¥ä½œæµå®šä¹‰ç›®å½•

| å·¥ä½œæµ | è·¯å¾„ | ç”¨é€” |
|--------|------|------|
| **åè°ƒå™¨** | `agents/coordinator/AGENT.md` | è½»é‡çº§ç¼–æ’ï¼Œå§”æ‰˜ç»™é˜¶æ®µå·¥ä½œæµ |
| **é˜¶æ®µ1** | `agents/phase-1-refinement/AGENT.md` | é—®é¢˜æ¾„æ¸…å’Œç»“æ„åŒ– |
| **é˜¶æ®µ2** | `agents/phase-2-planning/AGENT.md` | å­ä¸»é¢˜åˆ†è§£å’Œä»£ç†è§„åˆ’ |
| **é˜¶æ®µ3** | `agents/phase-3-execution/AGENT.md` | å¹¶è¡Œä»£ç†éƒ¨ç½²å’Œæ”¶é›† |
| **é˜¶æ®µ4** | `agents/phase-4-processing/AGENT.md` | MCP åŸºç¡€äº‹å®/å®ä½“æå– |
| **é˜¶æ®µ5** | `agents/phase-5-synthesis/AGENT.md` | çŸ¥è¯†ç»¼åˆä¸å¼•ç”¨ |
| **é˜¶æ®µ6** | `agents/phase-6-validation/AGENT.md` | è´¨é‡éªŒè¯å’Œçº¢é˜Ÿè¯„å®¡ |
| **é˜¶æ®µ7** | `agents/phase-7-output/AGENT.md` | æœ€ç»ˆäº¤ä»˜ç‰©ç”Ÿæˆ |

### æ”¯æŒä»£ç†å·¥ä½œæµ

| å·¥ä½œæµ | è·¯å¾„ | è‡ªä¸»æ€§ |
|--------|------|--------|
| **ç»¼åˆå™¨** | `agents/synthesizer-agent/AGENT.md` | é«˜ |
| **çº¢é˜Ÿ** | `agents/red-team-agent/AGENT.md` | é«˜ |
| **GoT** | `agents/got-agent/AGENT.md` | é«˜ |
| **æœ¬ä½“ä¾¦å¯Ÿ** | `agents/ontology-scout-agent/AGENT.md` | ä¸­ |

### ä»£ç†é€šä¿¡åè®®

```typescript
interface AgentMessage {
  from: string;           // å‘é€è€… ID
  to: string;             // æ¥æ”¶è€… ID
  type: 'request' | 'response' | 'event';
  payload: {
    task: string;         // ä»»åŠ¡æè¿°
    context: any;         // ä¸Šä¸‹æ–‡æ•°æ®
    citations: string[];  // æ¥æºåˆ—è¡¨
  };
  timestamp: number;
}
```

---

## MCP å·¥å…·æ¶æ„

### å·¥å…·åˆ†ç±»

```
MCP Server (.claude/mcp-server/)
â”œâ”€â”€ æ ¸å¿ƒå·¥å…· (5)
â”‚   â”œâ”€â”€ fact-extract      # äº‹å®æå–
â”‚   â”œâ”€â”€ entity-extract    # å®ä½“æå–
â”‚   â”œâ”€â”€ citation-validate # å¼•ç”¨éªŒè¯
â”‚   â”œâ”€â”€ source-rate       # æ¥æºè¯„çº§
â”‚   â””â”€â”€ conflict-detect   # çŸ›ç›¾æ£€æµ‹
â”‚
â”œâ”€â”€ æ‰¹å¤„ç†å·¥å…· (5)
â”‚   â”œâ”€â”€ batch-fact-extract
â”‚   â”œâ”€â”€ batch-entity-extract
â”‚   â”œâ”€â”€ batch-citation-validate
â”‚   â”œâ”€â”€ batch-source-rate
â”‚   â””â”€â”€ batch-conflict-detect
â”‚
â””â”€â”€ çŠ¶æ€å·¥å…· (11)
    â”œâ”€â”€ create_research_session
    â”œâ”€â”€ update_session_status
    â”œâ”€â”€ get_session_info
    â”œâ”€â”€ register_agent
    â”œâ”€â”€ update_agent_status
    â”œâ”€â”€ get_active_agents
    â”œâ”€â”€ update_current_phase
    â”œâ”€â”€ get_current_phase
    â”œâ”€â”€ checkpoint_phase
    â”œâ”€â”€ log_activity
    â””â”€â”€ render_progress
```

### å·¥å…·æ¥å£è®¾è®¡

```typescript
// ç»Ÿä¸€æå–æ¥å£
interface ExtractResult {
  mode: 'fact' | 'entity' | 'all';
  items: ExtractedItem[];
  metadata: {
    source_url: string;
    extracted_at: string;
    confidence: number;
  };
}

// ç»Ÿä¸€éªŒè¯æ¥å£
interface ValidationResult {
  mode: 'citation' | 'source' | 'all';
  valid: boolean;
  issues: ValidationIssue[];
  quality_rating: 'A' | 'B' | 'C' | 'D' | 'E';
}
```

### çŠ¶æ€ç®¡ç†æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UnifiedStateManager                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              SQLite (Single Source of Truth)          â”‚   â”‚
â”‚  â”‚  â€¢ sessions  â€¢ agents  â€¢ phases  â€¢ activity_log      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚         â–¼                    â–¼                    â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Event       â”‚     â”‚ Progress    â”‚     â”‚ Recovery    â”‚  â”‚
â”‚  â”‚ Emitter     â”‚     â”‚ Renderer    â”‚  â”‚ Handler     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®åº“æ¨¡å¼** (ç®€åŒ–):

```sql
CREATE TABLE sessions (
  id TEXT PRIMARY KEY,
  topic TEXT,
  status TEXT,
  created_at TIMESTAMP,
  metadata JSON
);

CREATE TABLE agents (
  id TEXT PRIMARY KEY,
  session_id TEXT,
  type TEXT,
  status TEXT,
  FOREIGN KEY (session_id) REFERENCES sessions(id)
);

CREATE TABLE phases (
  session_id TEXT,
  phase_number INTEGER,
  status TEXT,
  checkpoint_data JSON,
  PRIMARY KEY (session_id, phase_number)
);

CREATE TABLE activity_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  session_id TEXT,
  phase INTEGER,
  event_type TEXT,
  message TEXT,
  timestamp TIMESTAMP
);
```

---

## ä»¤ç‰Œç®¡ç†

### TokenBudgetManager

```typescript
interface TokenBudget {
  max_tokens: number;        // æ€»é¢„ç®— (é»˜è®¤: 500K)
  phase_allocations: {       // é˜¶æ®µåˆ†é…
    [phase: number]: number
  };
  warning_threshold: 0.8;    // è­¦å‘Šé˜ˆå€¼
  hard_limit: boolean;       // ç¡¬é™åˆ¶å¼€å…³
}

class TokenBudgetManager {
  allocate(sessionId: string, plan: ResearchPlan): void;
  checkUsage(sessionId: string, phase: number): BudgetStatus;
  enforceLimit(sessionId: string): boolean;
}
```

### é¢„ç®—åˆ†é…ç­–ç•¥

```
Phase 1 (Question): 5%   â†’ 25K tokens
Phase 2 (Planning):  10%  â†’ 50K tokens
Phase 3 (Querying):  40%  â†’ 200K tokens
Phase 4 (Process):   15%  â†’ 75K tokens
Phase 5 (Synthesis): 20%  â†’ 100K tokens
Phase 6 (Validate):  7%   â†’ 35K tokens
Phase 7 (Output):    3%   â†’ 15K tokens
```

---

## æ¢å¤ç³»ç»Ÿ

### RecoveryHandler

```typescript
interface RecoveryPlan {
  can_resume: boolean;
  last_checkpoint: PhaseCheckpoint;
  rerun_phases: number[];
  estimated_rework_cost: number;
}

class RecoveryHandler {
  detectInterruption(sessionId: string): boolean;
  generateRecoveryPlan(sessionId: string): RecoveryPlan;
  executeRecovery(sessionId: string): Promise<void>;
}
```

### æ£€æŸ¥ç‚¹ç­–ç•¥

```
Phase Checkpoints:
â”œâ”€â”€ Phase 1: After structured prompt created
â”œâ”€â”€ Phase 2: After research plan approved
â”œâ”€â”€ Phase 3: After all agents complete
â”œâ”€â”€ Phase 4: After MCP processing complete
â”œâ”€â”€ Phase 5: After synthesis draft created
â”œâ”€â”€ Phase 6: After validation passed
â””â”€â”€ Phase 7: After all outputs generated
```

---

## æ‰©å±•ç‚¹

### æ·»åŠ æ–°æŠ€èƒ½

1. åˆ›å»ºæŠ€èƒ½ç›®å½• `.claude/skills/new-skill/`
2. æ·»åŠ  SKILL.md (å…ƒæ•°æ®)
3. ç¼–å†™ instructions.md (å®ç°æŒ‡å—)
4. æä¾› examples.md (ä½¿ç”¨æ¨¡å¼)
5. æµ‹è¯•ä¸é›†æˆ

### æ·»åŠ æ–°å‘½ä»¤

1. åˆ›å»ºå‘½ä»¤æ–‡ä»¶ `.claude/commands/new-command.md`
2. å®šä¹‰å‘½ä»¤è¯­æ³•å’Œå‚æ•°
3. æ˜ å°„åˆ°é€‚å½“çš„æŠ€èƒ½
4. æ›´æ–° README.md

### æ·»åŠ æ–°ä»£ç†å·¥ä½œæµ

1. åˆ›å»ºå·¥ä½œæµå®šä¹‰ `.claude/agents/new-workflow/AGENT.md`
2. å®šä¹‰ä»£ç†è§’è‰²å’Œç„¦ç‚¹
3. æŒ‡å®šæ‰€éœ€å·¥å…·
4. å®šä¹‰è¾“å‡ºæ ¼å¼
5. é›†æˆåˆ°åè°ƒå™¨

---

## æ¶æ„å†³ç­–è®°å½• (ADR)

### ADR-001: ä½¿ç”¨ SQLite ä½œä¸ºçŠ¶æ€å­˜å‚¨

**çŠ¶æ€**: å·²æ¥å—

**ä¸Šä¸‹æ–‡**: éœ€è¦æŒä¹…åŒ–ç ”ç©¶çŠ¶æ€ã€ä»£ç†ä¿¡æ¯å’Œè¿›åº¦è·Ÿè¸ªã€‚

**å†³ç­–**: ä½¿ç”¨ SQLite è€Œé JSON æ–‡ä»¶ã€‚

**ç†ç”±**:
- ACID äº‹åŠ¡ä¿è¯
- å¹¶å‘å®‰å…¨
- æŸ¥è¯¢èƒ½åŠ›
- æ— éœ€å¤–éƒ¨ä¾èµ–

**åæœ**:
- âœ… å¯é çš„çŠ¶æ€ç®¡ç†
- âœ… ç®€å•çš„å¤‡ä»½/æ¢å¤
- âš ï¸ éœ€è¦æ•°æ®åº“è¿ç§»ç­–ç•¥

### ADR-002: æŠ€èƒ½ä½œä¸ºè–„å°è£…å±‚

**çŠ¶æ€**: å·²æ¥å—

**ä¸Šä¸‹æ–‡**: éœ€è¦ç»„ç»‡ç ”ç©¶æ‰§è¡Œé€»è¾‘ã€‚

**å†³ç­–**: æŠ€èƒ½ä»…è´Ÿè´£è¾“å…¥éªŒè¯å’Œä»£ç†è°ƒç”¨ï¼Œä¸šåŠ¡é€»è¾‘åœ¨ä»£ç†å·¥ä½œæµä¸­ã€‚

**ç†ç”±**:
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- ä»£ç†å·¥ä½œæµå¯ç‹¬ç«‹æµ‹è¯•
- æŠ€èƒ½ä¿æŒç®€å•å¯ç»´æŠ¤

**åæœ**:
- âœ… æ¨¡å—åŒ–æ¶æ„
- âœ… æ˜“äºæ‰©å±•
- âš ï¸ éœ€è¦ç†è§£ä¸¤å±‚é—´æ¥

### ADR-003: ä½¿ç”¨ general-purpose ä»£ç†ç±»å‹

**çŠ¶æ€**: å·²æ¥å—

**ä¸Šä¸‹æ–‡**: éœ€è¦æ‰§è¡Œå¤æ‚çš„å¤šé˜¶æ®µç ”ç©¶å·¥ä½œæµã€‚

**å†³ç­–**: ä½¿ç”¨ Claude Code å†…ç½®çš„ general-purpose ä»£ç†ï¼ŒåµŒå…¥å·¥ä½œæµæŒ‡ä»¤ã€‚

**ç†ç”±**:
- æ— éœ€è‡ªå®šä¹‰ä»£ç†å®ç°
- å·¥ä½œæµå®šä¹‰å¯ä½œä¸ºæ–‡æ¡£
- åˆ©ç”¨å†…ç½®èƒ½åŠ›

**åæœ**:
- âœ… ç®€åŒ–å®ç°
- âœ… è‡ªå¸¦å·¥å…·è®¿é—®
- âš ï¸ ä¾èµ–æŒ‡ä»¤è´¨é‡

---

## æ€§èƒ½è€ƒè™‘

### å¹¶è¡Œæ‰§è¡Œ

```typescript
// éƒ¨ç½²å¤šä¸ªä»£ç†å¹¶è¡Œæ‰§è¡Œ
const agents = [
  deployAgent('web-research-1'),
  deployAgent('web-research-2'),
  deployAgent('academic-1'),
  deployAgent('cross-reference')
];

// ç­‰å¾…æ‰€æœ‰å®Œæˆ
const results = await Promise.all(agents);
```

### ç¼“å­˜ç­–ç•¥

```
Cache Levels:
â”œâ”€â”€ L1: å†…å­˜ç¼“å­˜ (ä¼šè¯å†…)
â”œâ”€â”€ L2: MCP å·¥å…·ç¼“å­˜ (è·¨ä¼šè¯)
â””â”€â”€ L3: å†…å®¹å‹ç¼© (é•¿æ–‡æœ¬)
```

### è´¨é‡ä¸é€Ÿåº¦æƒè¡¡

| æ¨¡å¼ | ä»£ç†æ•° | æ·±åº¦ | é¢„æœŸæ—¶é—´ | è´¨é‡ |
|------|--------|------|----------|------|
| å¿«é€Ÿç ”ç©¶ | 3-4 | 2 | 5-10 åˆ†é’Ÿ | ä¸­ |
| æ ‡å‡†ç ”ç©¶ | 5-6 | 3 | 15-30 åˆ†é’Ÿ | é«˜ |
| å…¨é¢ç ”ç©¶ | 6-8 | 4 | 30-60 åˆ†é’Ÿ | æœ€é«˜ |

---

## å®‰å…¨è€ƒè™‘

### æ•°æ®éšç§

- æ— ç”¨æˆ·æ•°æ®æŒä¹…åŒ–åˆ°å¤–éƒ¨
- ç ”ç©¶è¾“å‡ºä»…æœ¬åœ°ä¿å­˜
- æ— å¤–éƒ¨ API è°ƒç”¨ (é™¤ç½‘ç»œæœç´¢)

### æ¥æºéªŒè¯

- éªŒè¯ URL çœŸå®æ€§
- æ£€æŸ¥æ¶æ„å†…å®¹
- éªŒè¯ SSL è¯ä¹¦
- æ ‡è®°å¯ç–‘æ¥æº

---

## æ•…éšœå¤„ç†

### å¸¸è§é—®é¢˜

| é—®é¢˜ | æ£€æµ‹ | æ¢å¤ |
|------|------|------|
| ä»£ç†è¶…æ—¶ | ä»¤ç‰Œä½¿ç”¨åœæ» | ä»æ£€æŸ¥ç‚¹æ¢å¤ |
| å¼•ç”¨ç¼ºå¤± | éªŒè¯å¤±è´¥ | æ ‡è®°äººå·¥å®¡æ ¸ |
| çŸ›ç›¾å‘ç° | conflict-detect | è®°å½•åˆ°æŠ¥å‘Š |
| ä»¤ç‰Œè¶…é™ | BudgetManager | åˆ†å‰²ä»»åŠ¡ |

### æ¢å¤ç­–ç•¥

```typescript
async function handleError(sessionId: string, error: Error) {
  // 1. è®°å½•é”™è¯¯
  await logActivity(sessionId, phase, 'error', error.message);

  // 2. ç”Ÿæˆæ¢å¤è®¡åˆ’
  const plan = await recoveryHandler.generateRecoveryPlan(sessionId);

  // 3. æ‰§è¡Œæ¢å¤
  if (plan.can_resume) {
    await executeRecovery(sessionId);
  } else {
    await escalateToUser(sessionId, error);
  }
}
```

---

## æœªæ¥å¢å¼º

### è®¡åˆ’åŠŸèƒ½

- [ ] å¯è§†åŒ– GoT å›¾æ¢ç´¢å™¨
- [ ] äº¤äº’å¼ç ”ç©¶ä»ªè¡¨æ¿
- [ ] å®æ—¶åä½œæ”¯æŒ
- [ ] è‡ªå®šä¹‰ä»£ç†æ¨¡æ¿
- [ ] é«˜çº§å¼•ç”¨ç®¡ç†
- [ ] å¤šè¯­è¨€æ”¯æŒ

### ç ”ç©¶é¢†åŸŸ

- æ”¹è¿›è¯„åˆ†å‡½æ•°
- æ›´å¥½çš„å†²çªè§£å†³
- è‡ªåŠ¨äº‹å®æ ¸æŸ¥
- æ¥æºå¯ä¿¡åº¦é¢„æµ‹
- åŠ¨æ€ä»£ç†åˆ†é…

---

**å®Œæ•´å®ç°ç»†èŠ‚è§ [RESEARCH_METHODOLOGY.md](RESEARCH_METHODOLOGY.md)**
