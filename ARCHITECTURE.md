# Architecture

**Claude Code Deep Research Agent** - ç³»ç»Ÿæ¶æ„æ–‡æ¡£ (v3.1)

> ğŸ“˜ **ç›¸å…³æ–‡æ¡£**: [CLAUDE.md](CLAUDE.md) | [RESEARCH_METHODOLOGY.md](RESEARCH_METHODOLOGY.md)

---

## è®¾è®¡åŸåˆ™

### æ ¸å¿ƒç†å¿µ

```
å›¾æ€ç»´ > çº¿æ€§æµç¨‹
æ™ºèƒ½è¿­ä»£ > å›ºå®šé˜¶æ®µ
æœåŠ¡å™¨å¤„ç† > å®¢æˆ·ç«¯å¤„ç†
ç¡¬çº¦æŸ > è½¯çº¦æŸ
```

### æ¶æ„ç›®æ ‡

1. **æ™ºèƒ½æ€§** - GoT åŠ¨æ€è·¯å¾„ä¼˜åŒ–ï¼Œè€Œéå›ºå®šæµç¨‹
2. **é«˜æ•ˆæ€§** - æœåŠ¡å™¨ç«¯æ‰¹å¤„ç†ï¼Œå‡å°‘ LLM è°ƒç”¨
3. **å¯é æ€§** - ç¡¬é¢„ç®—å¼ºåˆ¶ï¼Œè‡ªåŠ¨é”™è¯¯ä¿®å¤
4. **å¯è§‚æµ‹æ€§** - å®Œæ•´çš„å›¾çŠ¶æ€è¿½è¸ª

---

## ç³»ç»Ÿæ¶æ„

### v3.1 åˆ†å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ¥å£å±‚                             â”‚
â”‚              Commands: /deep-research [--fast]              â”‚
â”‚         (æ¨¡å¼æ£€æµ‹: Quick | Deep)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ invokes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GoT æ§åˆ¶å™¨ (Agent)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     research-coordinator-v3 (Graph Navigator)          â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  Generate â†’ Execute â†’ Score â†’ Prune â†’ Aggregate â†’ Loop â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  ç»ˆæ­¢æ¡ä»¶: confidence â‰¥ 0.9 OR budget exhausted        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  éƒ¨ç½² research-worker-v3 agents (å¹¶è¡Œæ¢ç´¢è·¯å¾„)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ MCP Tools    â”‚  â”‚ GoT State Mgmtâ”‚  â”‚ Hooks        â”‚     â”‚
â”‚  â”‚ (æ•°æ®å¤„ç†)    â”‚  â”‚ (Graph Ctrl)  â”‚  â”‚ (Budget/Heal)â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚        SQLite (sessions, paths, metrics)          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„æ¼”å˜

| ç‰ˆæœ¬ | å·¥ä½œæµ | å¤„ç† | æ§åˆ¶ | å±‚çº§ |
|------|--------|------|------|------|
| **v2.1** | çº¿æ€§ Phase 1-7 | Agent ä¾§ | è½¯çº¦æŸ | 4 å±‚ |
| **v3.0** | çº¿æ€§ Phase 1-7 | Agent ä¾§ | è½¯çº¦æŸ | 2 å±‚ |
| **v3.1** | GoT å¾ªç¯ | æœåŠ¡å™¨ä¾§ | ç¡¬çº¦æŸ | 2 å±‚ |

---

## ç›®å½•ç»“æ„ (v3.1)

```
.
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ commands/                  # ç”¨æˆ·å‘½ä»¤
â”‚   â”‚   â””â”€â”€ deep-research-v3.md    # v3.1 å‘½ä»¤ (æ”¯æŒ --fast)
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                    # ä»£ç†å®šä¹‰ (ç®€åŒ–)
â”‚   â”‚   â”œâ”€â”€ research-coordinator-v3/
â”‚   â”‚   â”‚   â””â”€â”€ AGENT.md           # GoT æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ research-worker-v3/
â”‚   â”‚   â”‚   â””â”€â”€ AGENT.md           # è·¯å¾„æ‰§è¡Œè€…
â”‚   â”‚   â””â”€â”€ data-processor-v3/
â”‚   â”‚       â””â”€â”€ AGENT.md           # æ•°æ®å¤„ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                     # ç”Ÿå‘½å‘¨æœŸ Hooks
â”‚   â”‚   â”œâ”€â”€ enforce-budget.js      # é¢„ç®—å¼ºåˆ¶ (pre-command)
â”‚   â”‚   â”œâ”€â”€ auto-heal.js           # é”™è¯¯ä¿®å¤ (on-error)
â”‚   â”‚   â”œâ”€â”€ auto-logger.js         # è‡ªåŠ¨æ—¥å¿—
â”‚   â”‚   â””â”€â”€ restore-context.js     # ä¸Šä¸‹æ–‡æ¢å¤
â”‚   â”‚
â”‚   â””â”€â”€ mcp-server/                # MCP æœåŠ¡å™¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ tools/
â”‚       â”‚   â”‚   â”œâ”€â”€ auto-process-data.ts  # v3.1 æ–°å¢
â”‚       â”‚   â”‚   â”œâ”€â”€ got-tools.ts          # GoT æ“ä½œ
â”‚       â”‚   â”‚   â”œâ”€â”€ batch-tools.ts        # æ‰¹å¤„ç†
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”œâ”€â”€ logic/
â”‚       â”‚   â”‚   â”œâ”€â”€ graph-controller.ts   # v3.1 å¢å¼º
â”‚       â”‚   â”‚   â””â”€â”€ types.ts
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â””â”€â”€ data/
â”‚           â””â”€â”€ research_state.db
â”‚
â”œâ”€â”€ RESEARCH/                      # ç ”ç©¶è¾“å‡º
â”‚   â””â”€â”€ [topic]/
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ executive_summary.md
â”‚       â”œâ”€â”€ full_report.md
â”‚       â”œâ”€â”€ data/
â”‚       â”‚   â”œâ”€â”€ raw/               # åŸå§‹æ•°æ®
â”‚       â”‚   â”œâ”€â”€ processed/         # æœåŠ¡å™¨å¤„ç†
â”‚       â”‚   â””â”€â”€ got_graph.json     # GoT çŠ¶æ€ (v3.1)
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ CLAUDE.md                      # å¿«é€Ÿå‚è€ƒ
â”œâ”€â”€ ARCHITECTURE.md                # æœ¬æ–‡æ¡£
â”œâ”€â”€ RESEARCH_METHODOLOGY.md        # ç ”ç©¶æ–¹æ³•è®º
â””â”€â”€ README.md
```

---

## Graph of Thoughts (GoT) æ¶æ„

### æ ¸å¿ƒæ¦‚å¿µ

**ä¼ ç»Ÿçº¿æ€§æµç¨‹** vs **å›¾æ€ç»´**:

```
OLD (v3.0):
Phase 1 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4 â†’ Phase 5 â†’ Phase 6 â†’ Phase 7

NEW (v3.1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Generateâ”‚â”€â”€â”€â–¶â”‚ Execute â”‚â”€â”€â”€â–¶â”‚  Score  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚       â”‚                              â”‚                  â”‚
â”‚       â–¼                              â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Prune   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ KeepBestâ”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚       â”‚                              â”‚                  â”‚
â”‚       â–¼                              â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚                  â”‚
â”‚  â”‚Aggregateâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚       â”‚                                                â”‚
â”‚       â–¼                                                â”‚
â”‚  Check Confidence                                      â”‚
â”‚  (â‰¥ 0.9?) â”€â”€Noâ”€â”€â–¶ Loop                                 â”‚
â”‚      â”‚                                                   â”‚
â”‚      Yes                                                 â”‚
â”‚      â–¼                                                   â”‚
â”‚  Synthesize Report                                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### GoT æ“ä½œ

| æ“ä½œ | å·¥å…· | æè¿° |
|------|------|------|
| `generate_paths(k)` | `mcp__deep-research__generate_paths` | ç”Ÿæˆ k ä¸ªæ¢ç´¢è·¯å¾„ |
| `score_and_prune` | `mcp__deep-research__score_and_prune` | è¯„åˆ†å¹¶ä¿ç•™ top N |
| `aggregate_paths` | `mcp__deep-research__aggregate_paths` | åˆå¹¶è·¯å¾„ |

### è·¯å¾„æ¨¡æ¿

```typescript
// é¢„å®šä¹‰è·¯å¾„æ¨¡æ¿ (v3.1)
const PATH_TEMPLATES = {
  academic: {
    focus: 'Academic Research',
    query_pattern: '{topic} academic papers research {year}',
    sources: ['scholar.google.com', 'arxiv.org'],
    weight: 0.3
  },
  industry: {
    focus: 'Industry Practices',
    query_pattern: '{topic} industry report case study',
    sources: ['mckinsey.com', 'gartner.com'],
    weight: 0.25
  },
  policy: {
    focus: 'Policy & Governance',
    query_pattern: '{topic} policy regulation governance',
    sources: ['gov.uk', 'europa.eu'],
    weight: 0.2
  }
  // ... technical, news
};
```

### å¤šæ ·åŒ–ç­–ç•¥

| ç­–ç•¥ | æè¿° | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `orthogonal` | æœ€å°åŒ–è·¯å¾„é‡å  | éœ€è¦å…¨é¢è¦†ç›– |
| `complementary` | è·¯å¾„ç›¸äº’å¢å¼º | éœ€è¦æ·±åº¦äº¤å‰éªŒè¯ |
| `exploratory` | å¹¿æ³›æ¢ç´¢ | æ—©æœŸç ”ç©¶é˜¶æ®µ |
| `focused` | æ·±åº¦æŒ–æ˜ | ç‰¹å®šæ–¹é¢ç ”ç©¶ |

---

## MCP å·¥å…·æ¶æ„ (v3.1)

### æ–°å¢å·¥å…·

```typescript
// v3.1 æ–°å¢: è‡ªåŠ¨æ•°æ®å¤„ç†å·¥å…·
interface AutoProcessDataInput {
  session_id: string;
  input_dir: string;      // RESEARCH/topic/data/raw/
  output_dir: string;     // RESEARCH/topic/data/processed/
  operations: [
    'fact_extraction',
    'entity_extraction',
    'citation_validation',
    'conflict_detection'
  ];
}
```

### å·¥å…·åˆ†ç±»

```
MCP Server Tools:
â”œâ”€â”€ GoT Operations (3) - v3.1 æ¿€æ´»
â”‚   â”œâ”€â”€ generate_paths
â”‚   â”œâ”€â”€ score_and_prune
â”‚   â””â”€â”€ aggregate_paths
â”‚
â”œâ”€â”€ Auto-Processing (1) - v3.1 æ–°å¢
â”‚   â””â”€â”€ auto_process_data
â”‚
â”œâ”€â”€ Unified Tools (3)
â”‚   â”œâ”€â”€ extract (fact + entity)
â”‚   â”œâ”€â”€ validate (citation + source)
â”‚   â””â”€â”€ conflict-detect
â”‚
â”œâ”€â”€ Batch Processing (3)
â”‚   â”œâ”€â”€ batch-extract
â”‚   â”œâ”€â”€ batch-validate
â”‚   â””â”€â”€ batch-conflict-detect
â”‚
â””â”€â”€ State Management (11)
    â”œâ”€â”€ Session: create, update, get
    â”œâ”€â”€ Agent: register, update, get_active
    â”œâ”€â”€ Phase: update, get, checkpoint
    â””â”€â”€ Log: log_activity, render_progress
```

### æ•°æ®æµç¨‹å˜åŒ–

**v3.0** (Agent ä¾§å¤„ç†):
```
Agent â†’ è¯»å–æ–‡ä»¶ â†’ é€ä¸ªå¤„ç† â†’ æå–äº‹å® â†’ ä¿å­˜
       (å ç”¨å¤§é‡ä¸Šä¸‹æ–‡çª—å£)
```

**v3.1** (æœåŠ¡å™¨ä¾§å¤„ç†):
```
Agent â†’ è°ƒç”¨ auto_process_data â†’ æœåŠ¡å™¨æ‰¹å¤„ç† â†’ è¿”å›ç»“æœ
       (ä¸€ä¸ªå‘½ä»¤ï¼Œæ— ä¸Šä¸‹æ–‡å‹åŠ›)
```

---

## Hooks ç³»ç»Ÿ (v3.1)

### Hook ç±»å‹

| Hook | è§¦å‘æ—¶æœº | åŠŸèƒ½ |
|------|----------|------|
| `enforce-budget.js` | Pre-command | ç¡¬é¢„ç®—é™åˆ¶ |
| `auto-heal.js` | On-error | è‡ªåŠ¨é”™è¯¯ä¿®å¤ |
| `auto-logger.js` | Post-tool | è‡ªåŠ¨æ—¥å¿—è®°å½• |
| `restore-context.js` | Startup | æ¢å¤æœªå®Œæˆä¼šè¯ |

### é¢„ç®—å¼ºåˆ¶ Hook

```javascript
// .claude/hooks/enforce-budget.js
// ç‰©ç†å±‚é¢çš„ Token é˜»æ–­

const BUDGET_LIMIT = 500000;
const usage = getTokenUsageFromDB();

if (usage >= BUDGET_LIMIT) {
  console.error('âŒ BUDGET EXHAUSTED');
  process.exit(1);  // é˜»æ­¢å‘½ä»¤æ‰§è¡Œ
}
```

**ä¸ºä»€ä¹ˆéœ€è¦ç¡¬çº¦æŸï¼Ÿ**
- LLM ç»å¸¸å¿½ç•¥ Prompt ä¸­çš„è½¯é™åˆ¶
- é¢„ç®—è¶…æ”¯ä¼šå¯¼è‡´æ„å¤–æˆæœ¬
- ç‰©ç†é˜»æ–­æ˜¯å”¯ä¸€å¯é çš„æ–¹å¼

### è‡ªåŠ¨ä¿®å¤ Hook

```javascript
// .claude/hooks/auto-heal.js
// æ£€æµ‹å¹¶ä¿®å¤å¸¸è§é”™è¯¯

const errorType = detectError(error);

switch (errorType) {
  case 'sqlite_lock':
    healSQLiteLock();  // æ¸…ç† WAL æ–‡ä»¶
    break;
  case 'mcp_down':
    healMCPDown();     // é‡å¯æœåŠ¡å™¨
    break;
  case 'permission':
    healPermissions(); // ä¿®å¤æƒé™
    break;
}
```

---

## ç ”ç©¶æ¨¡å¼ (v3.1)

### Quick Mode (`--fast`)

```bash
/deep-research "ç®€å•é—®é¢˜" --fast
```

**ç‰¹ç‚¹**:
- å•ä¸€è·¯å¾„ï¼Œæ—  GoT
- 3-5 ä¸ªæ¥æº
- 5-10 åˆ†é’Ÿå®Œæˆ
- é€‚ç”¨äºæ˜ç¡®ã€ç®€å•çš„é—®é¢˜

**æµç¨‹**:
```
éªŒè¯é—®é¢˜ â†’ ç”ŸæˆæŸ¥è¯¢ â†’ è·å–æ¥æº â†’ æå–äº‹å® â†’ è¾“å‡ºç­”æ¡ˆ
```

### Deep Mode (é»˜è®¤)

```bash
/deep-research "å¤æ‚ä¸»é¢˜"
```

**ç‰¹ç‚¹**:
- GoT è·¯å¾„ä¼˜åŒ–
- 20+ ä¸ªæ¥æº
- 30-60 åˆ†é’Ÿå®Œæˆ
- é€‚ç”¨äºå¤æ‚ã€å¤šæ–¹é¢ä¸»é¢˜

**æµç¨‹**:
```
åˆå§‹åŒ– GoT â†’ ç”Ÿæˆè·¯å¾„ â†’ æ‰§è¡Œ â†’ è¯„åˆ† â†’ å‰ªæ â†’ èšåˆ â†’ å¾ªç¯
             â†“
         ç»ˆæ­¢æ¡ä»¶: confidence â‰¥ 0.9 OR budget exhausted
```

---

## æ€§èƒ½ä¼˜åŒ– (v3.1)

### Token ä½¿ç”¨å¯¹æ¯”

| æ“ä½œ | v3.0 | v3.1 | èŠ‚çœ |
|------|------|------|------|
| Phase 4 å¤„ç† | ~50K | ~5K | 90% |
| è·¯å¾„ä¼˜åŒ– | N/A | æ™ºèƒ½å‰ªæ | 30-50% |
| æ€»ä½“ (Deep) | ~500K | ~300K | 40% |

### å¹¶è¡Œæ‰§è¡Œ

```typescript
// v3.1: å¹¶è¡Œéƒ¨ç½² workers
const paths = await generate_paths({ k: 3 });

// å•æ¬¡å“åº”ï¼Œå¤šä¸ª Task è°ƒç”¨
await Promise.all([
  Task({ subagent_type: 'research-worker-v3', prompt: paths[0].query }),
  Task({ subagent_type: 'research-worker-v3', prompt: paths[1].query }),
  Task({ subagent_type: 'research-worker-v3', prompt: paths[2].query })
]);
```

---

## æ•°æ®åº“æ¨¡å¼ (v3.1)

### æ–°å¢è¡¨

```sql
-- GoT å›¾çŠ¶æ€
CREATE TABLE got_nodes (
  id TEXT PRIMARY KEY,
  session_id TEXT,
  path_id TEXT,
  node_type TEXT,  -- 'generate', 'execute', 'score', 'prune', 'aggregate'
  data JSON,
  timestamp TIMESTAMP,
  FOREIGN KEY (session_id) REFERENCES sessions(id)
);

-- GoT æ“ä½œå†å²
CREATE TABLE got_operations (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  session_id TEXT,
  operation TEXT,
  input_data JSON,
  output_data JSON,
  timestamp TIMESTAMP
);
```

---

## æ¶æ„å†³ç­–è®°å½• (ADR)

### ADR-004: é‡‡ç”¨ GoT æ¶æ„ (v3.1)

**çŠ¶æ€**: å·²æ¥å—

**ä¸Šä¸‹æ–‡**: v3.0 çš„çº¿æ€§æµç¨‹æ— æ³•é€‚åº”å¤æ‚ç ”ç©¶çš„åŠ¨æ€éœ€æ±‚ã€‚

**å†³ç­–**: é‡‡ç”¨ Graph of Thoughts åŠ¨æ€è·¯å¾„ä¼˜åŒ–ã€‚

**ç†ç”±**:
- æ™ºèƒ½å‰ªæèŠ‚çœèµ„æº
- èšåˆæé«˜è´¨é‡
- ç½®ä¿¡åº¦é©±åŠ¨çš„ç»ˆæ­¢æ¡ä»¶

**åæœ**:
- âœ… æ›´é«˜çš„ç ”ç©¶è´¨é‡
- âœ… æ›´ä½çš„ Token ä½¿ç”¨
- âš ï¸ éœ€è¦ç†è§£å›¾éå†

### ADR-005: æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç† (v3.1)

**çŠ¶æ€**: å·²æ¥å—

**ä¸Šä¸‹æ–‡**: Agent ä¾§å¤„ç†å ç”¨å¤§é‡ä¸Šä¸‹æ–‡çª—å£ã€‚

**å†³ç­–**: å°† Phase 4 ç§»è‡³æœåŠ¡å™¨ç«¯ (`auto_process_data`)ã€‚

**ç†ç”±**:
- å‡å°‘ LLM è°ƒç”¨
- ç¡®å®šæ€§å¤„ç†
- æ‰¹å¤„ç†ä¼˜åŒ–

**åæœ**:
- âœ… èŠ‚çœ 90% Phase 4 Token
- âš ï¸ éœ€è¦ MCP å·¥å…·è°ƒç”¨

### ADR-006: ç¡¬é¢„ç®—çº¦æŸ (v3.1)

**çŠ¶æ€**: å·²æ¥å—

**ä¸Šä¸‹æ–‡**: LLM å¿½ç•¥ Prompt ä¸­çš„è½¯é™åˆ¶ã€‚

**å†³ç­–**: ä½¿ç”¨ pre-command hook å®ç°ç‰©ç†é˜»æ–­ã€‚

**ç†ç”±**:
- å”¯ä¸€å¯é çš„æ–¹å¼
- é˜²æ­¢æ„å¤–æˆæœ¬
- ç”¨æˆ·æ˜ç¡®åé¦ˆ

**åæœ**:
- âœ… é›¶é¢„ç®—è¶…æ”¯
- âš ï¸ éœ€è¦ç”¨æˆ·é…ç½®

---

## è¿ç§»æŒ‡å—

### ä» v3.0 å‡çº§åˆ° v3.1

1. **åˆ é™¤æ—§æ–‡ä»¶**:
   ```bash
   rm commands/deep-research.md
   rm commands/quick-research.md
   rm shared/skills/
   ```

2. **æ›´æ–°é…ç½®**:
   ```bash
   # è®¾ç½®é¢„ç®—é™åˆ¶
   export RESEARCH_BUDGET_LIMIT=500000
   ```

3. **ä½¿ç”¨æ–°å‘½ä»¤**:
   ```bash
   # Quick æ¨¡å¼
   /deep-research "ç®€å•é—®é¢˜" --fast

   # Deep æ¨¡å¼
   /deep-research "å¤æ‚ä¸»é¢˜"
   ```

---

## æœªæ¥å¢å¼º

### v3.2 è®¡åˆ’

- [ ] å¯è§†åŒ– GoT å›¾ UI
- [ ] å®æ—¶ç½®ä¿¡åº¦æ˜¾ç¤º
- [ ] åŠ¨æ€é¢„ç®—åˆ†é…
- [ ] è·¯å¾„æ¨èç³»ç»Ÿ
- [ ] å¤šæ¨¡æ€æ”¯æŒ (å›¾ç‰‡ã€è§†é¢‘)

### ç ”ç©¶æ–¹å‘

- æ›´æ™ºèƒ½çš„è·¯å¾„ç”Ÿæˆ
- è‡ªé€‚åº”å‰ªæé˜ˆå€¼
- è·¨ä¼šè¯å­¦ä¹ 
- åä½œç ”ç©¶æ”¯æŒ

---

**å®Œæ•´å®ç°ç»†èŠ‚è§ [RESEARCH_METHODOLOGY.md](RESEARCH_METHODOLOGY.md)**
